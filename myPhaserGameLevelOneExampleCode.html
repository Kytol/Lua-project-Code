<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Spin2Win - Harjoitus level2</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
         <script src="../v2/build/phaser.min.js"></script>
         <style type="text/css">
         </style>
    </head>
    <body>
        <style>html{
        background-color:lightblue;
        }</style>
        <script type="text/javascript">
        
        var Phaser, player, sprite1a, sprite1b, finish, finishtext;
        var enemyg;
        var block_obstacle1, block_obstacle2, block_obstacle3, block_obstacle4;
        var horizontal_obstacle1, horizontal_obstacle2, horizontal_obstacle3, horizontal_obstacle4, horizontal_obstacle5, horizontal_obstacle6, horizontal_obstacle7, horizontal_obstacle8, horizontal_obstacle9, horizontal_obstacle10, horizontal_obstacle11, horizontal_obstacle12, horizontal_obstacle13, horizontal_obstacle14, horizontal_obstacle15, horizontal_obstacle16, horizontal_obstacle17, horizontal_obstacle18, horizontal_obstacle19, horizontal_obstacle20, horizontal_obstacle21, horizontal_obstacle22, horizontal_obstacle23, horizontal_obstacle24, horizontal_obstacle25, horizontal_obstacle26;
        var vertical_obstacle1, vertical_obstacle2, vertical_obstacle3;
        window.onload = function() {
        var game = new Phaser.Game(1280, 720, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update, render: render });
         
        function preload() {
          game.load.image('player', '../gameProject/assets/graphics/player.png');
          game.load.image('obstacle1', '../gameProject/assets/graphics/obstacles/block_obstacle.png');
          game.load.image('obstacle2', '../gameProject/assets/graphics/obstacles/horizontal_obstacle_1000px.png');
          game.load.image('obstacle3', '../gameProject/assets/graphics/obstacles/vertical_obstacle_353px.png');
          game.load.image('finish', '../gameProject/assets/graphics/Block2.png');
          game.load.physics('physicsData', '../gameProject/assets/physics/physics.full2.json');
        }

        function create() {
            game.physics.startSystem(Phaser.Physics.P2JS);
            game.stage.backgroundColor = "#4488BB";
            
            enemyg = game.add.physicsGroup(Phaser.Physics.P2JS);
	        
	        //blocks
	        
	        block_obstacle1 = enemyg.create(100, -2700, 'obstacle1');
	        block_obstacle1.anchor.setTo(0.5, 0.5);
	        game.physics.p2.enable(block_obstacle1);
	        block_obstacle1.name = 'obstacle';
	        block_obstacle1.body.collideWorldBounds = false;
	        
	        block_obstacle2 = enemyg.create(game.world.width + 100, -2700, 'obstacle1');
	        block_obstacle2.anchor.setTo(0.5, 0.5);
	        game.physics.p2.enable(block_obstacle2);
	        block_obstacle2.name = 'obstacle';
	        block_obstacle2.body.collideWorldBounds = false;
	        
	        block_obstacle3 = enemyg.create(-150, -3400, 'obstacle1');
	        block_obstacle3.anchor.setTo(0.5, 0.5);
	        game.physics.p2.enable(block_obstacle3);
	        block_obstacle3.name = 'obstacle';
	        block_obstacle3.body.collideWorldBounds = false;
	        
	        block_obstacle4 = enemyg.create(game.world.width - 150, -3400, 'obstacle1');
	        block_obstacle4.anchor.setTo(0.5, 0.5);
	        game.physics.p2.enable(block_obstacle4);
	        block_obstacle4.name = 'obstacle';
	        block_obstacle4.body.collideWorldBounds = false;
            
            //horizontal
            
            horizontal_obstacle1 = enemyg.create(0, -400, 'obstacle2');
            horizontal_obstacle1.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle1);
            horizontal_obstacle1.name = 'obstacle';
	        horizontal_obstacle1.body.collideWorldBounds = false;
	        
            horizontal_obstacle2 = enemyg.create(game.world.width, -400, 'obstacle2');
            horizontal_obstacle2.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle2);
            horizontal_obstacle2.name = 'obstacle';
            horizontal_obstacle2.body.collideWorldBounds = false;
            
            horizontal_obstacle3 = enemyg.create(100, -800, 'obstacle2');
            horizontal_obstacle3.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle3);
            horizontal_obstacle3.name = 'obstacle';
            horizontal_obstacle3.body.collideWorldBounds = false;
            
            horizontal_obstacle4 = enemyg.create(game.world.width + 100, -800, 'obstacle2');
            horizontal_obstacle4.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle4);
            horizontal_obstacle4.name = 'obstacle';
	        horizontal_obstacle4.body.collideWorldBounds = false;
	        
            horizontal_obstacle5 = enemyg.create(-350, -1400, 'obstacle2');
            horizontal_obstacle5.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle5);
            horizontal_obstacle5.name = 'obstacle';
	        horizontal_obstacle5.body.collideWorldBounds = false;
	        
            horizontal_obstacle6 = enemyg.create(game.world.width - 350, -1400, 'obstacle2');
            horizontal_obstacle6.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle6);
            horizontal_obstacle6.name = 'obstacle';
	        horizontal_obstacle6.body.collideWorldBounds = false;
	        
            horizontal_obstacle7 = enemyg.create(100, -1800, 'obstacle2');
            horizontal_obstacle7.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle7);
            horizontal_obstacle7.name = 'obstacle';
	        horizontal_obstacle7.body.collideWorldBounds = false;
	        
            horizontal_obstacle8 = enemyg.create(game.world.width + 100, -1800, 'obstacle2');
            horizontal_obstacle8.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle8);
            horizontal_obstacle8.name = 'obstacle';
	        horizontal_obstacle8.body.collideWorldBounds = false;
	        
            horizontal_obstacle9 = enemyg.create(-100, -2200, 'obstacle2');
            horizontal_obstacle9.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle9);
            horizontal_obstacle9.name = 'obstacle';
	        horizontal_obstacle9.body.collideWorldBounds = false;
	        
            horizontal_obstacle10 = enemyg.create(game.world.width - 100, -2200, 'obstacle2');
            horizontal_obstacle10.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle10);
            horizontal_obstacle10.name = 'obstacle';
	        horizontal_obstacle10.body.collideWorldBounds = false;
	        
            horizontal_obstacle11 = enemyg.create(game.world.width + 200, -4100, 'obstacle2');
            horizontal_obstacle11.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle11);
            horizontal_obstacle11.name = 'obstacle';
	        horizontal_obstacle11.body.collideWorldBounds = false;
	        
            horizontal_obstacle12 = enemyg.create(200, -4100, 'obstacle2');
            horizontal_obstacle12.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle12);
            horizontal_obstacle12.name = 'obstacle';
	        horizontal_obstacle12.body.collideWorldBounds = false;
	        
            horizontal_obstacle13 = enemyg.create(game.world.width + 200, -4300, 'obstacle2');
            horizontal_obstacle13.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle13);
            horizontal_obstacle13.name = 'obstacle';
	        horizontal_obstacle13.body.collideWorldBounds = false;
	        
            horizontal_obstacle14 = enemyg.create(200, -4300, 'obstacle2');
            horizontal_obstacle14.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle14);
            horizontal_obstacle14.name = 'obstacle';
	        horizontal_obstacle14.body.collideWorldBounds = false;
	        
            horizontal_obstacle15 = enemyg.create(game.world.width + 50, -4700, 'obstacle2');
            horizontal_obstacle15.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle15);
            horizontal_obstacle15.name = 'obstacle';
	        horizontal_obstacle15.body.collideWorldBounds = false;
	        
            horizontal_obstacle16 = enemyg.create(50, -4700, 'obstacle2');
            horizontal_obstacle16.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle16);
            horizontal_obstacle16.name = 'obstacle';
	        horizontal_obstacle16.body.collideWorldBounds = false;
	        
            horizontal_obstacle17 = enemyg.create(game.world.width + 50, -4900, 'obstacle2');
            horizontal_obstacle17.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle17);
            horizontal_obstacle17.name = 'obstacle';
	        horizontal_obstacle17.body.collideWorldBounds = false;
	        
            horizontal_obstacle18 = enemyg.create(50, -4900, 'obstacle2');
            horizontal_obstacle18.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle18);
            horizontal_obstacle18.name = 'obstacle';
	        horizontal_obstacle18.body.collideWorldBounds = false;
	        
            horizontal_obstacle19 = enemyg.create(game.world.width - 100, -5300, 'obstacle2');
            horizontal_obstacle19.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle19);
            horizontal_obstacle19.name = 'obstacle';
	        horizontal_obstacle19.body.collideWorldBounds = false;
	        
            horizontal_obstacle20 = enemyg.create(-100, -5300, 'obstacle2');
            horizontal_obstacle20.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle20);
            horizontal_obstacle20.name = 'obstacle';
	        horizontal_obstacle20.body.collideWorldBounds = false;
	        
            horizontal_obstacle21 = enemyg.create(game.world.width - 100, -5500, 'obstacle2');
            horizontal_obstacle21.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle21);
            horizontal_obstacle21.name = 'obstacle';
	        horizontal_obstacle21.body.collideWorldBounds = false;
	        
            horizontal_obstacle22 = enemyg.create(-100, -5500, 'obstacle2');
            horizontal_obstacle22.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle22);
            horizontal_obstacle22.name = 'obstacle';
	        horizontal_obstacle22.body.collideWorldBounds = false;
	        
            horizontal_obstacle23 = enemyg.create(game.world.width + 100, -6200, 'obstacle2');
            horizontal_obstacle23.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle23);
            horizontal_obstacle23.name = 'obstacle';
	        horizontal_obstacle23.body.collideWorldBounds = false;
	        
            horizontal_obstacle24 = enemyg.create(100, -6200, 'obstacle2');
            horizontal_obstacle24.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle24);
            horizontal_obstacle24.name = 'obstacle';
	        horizontal_obstacle24.body.collideWorldBounds = false;
	        
	        //finish obstacles
	        
            horizontal_obstacle25 = enemyg.create(-50, -6810, 'obstacle2');
            horizontal_obstacle25.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle25);
            horizontal_obstacle25.name = 'obstacle';
	        horizontal_obstacle25.body.collideWorldBounds = false;
	        
            horizontal_obstacle26 = enemyg.create(game.world.width + 50, -6810, 'obstacle2');
            horizontal_obstacle26.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(horizontal_obstacle26);
            horizontal_obstacle26.name = 'obstacle';
	        horizontal_obstacle26.body.collideWorldBounds = false;
	        
	        //vertical
	        
            vertical_obstacle1 = enemyg.create(750, -2700, 'obstacle3');
            vertical_obstacle1.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(vertical_obstacle1);
            vertical_obstacle1.name = 'obstacle';
	        vertical_obstacle1.body.collideWorldBounds = false;
	        
            vertical_obstacle2 = enemyg.create(500, -3400, 'obstacle3');
            vertical_obstacle2.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(vertical_obstacle2);
            vertical_obstacle2.name = 'obstacle';
	        vertical_obstacle2.body.collideWorldBounds = false;
	        
            vertical_obstacle3 = enemyg.create(750, -6340, 'obstacle3');
            vertical_obstacle3.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(vertical_obstacle3);
            vertical_obstacle3.name = 'obstacle';
	        vertical_obstacle3.body.collideWorldBounds = false;
	        
	        //WINNING SPRITE
	        finish = game.add.sprite(game.world.centerX, -6900, 'finish');
	        finish.anchor.setTo(0.5, 0.5);
            game.physics.p2.enable(finish);
            finish.name = 'finish';
	        finish.body.collideWorldBounds = false;
            
            //PLAYER
            //Two grey visible balls
            player = game.add.sprite(game.world.centerX, game.world.centerY+100, 'player');
            game.physics.p2.enable(player);
	        player.name = 'player';
            player.body.clearShapes();
	        player.body.loadPolygon(['physicsData'], 'player');
	        
	        //Invisible right ball with collision
	        sprite1a = game.add.sprite(game.world.centerX, game.world.centerY+100, 'player');
	        sprite1a.alpha = 0;
            game.physics.p2.enable(sprite1a);
	        sprite1a.name = 'sprite1a';
            sprite1a.body.clearShapes();
	        sprite1a.body.loadPolygon(['physicsData'], 'playera');
	                
	        //Invisible left ball with collision
	        sprite1b = game.add.sprite(game.world.centerX, game.world.centerY+100, 'player');
	        sprite1b.alpha = 0;
            game.physics.p2.enable(sprite1b);
	        sprite1b.name = 'sprite1b';
            sprite1b.body.clearShapes();
	        sprite1b.body.loadPolygon(['physicsData'], 'playerb');
	        //PLAYER ENDS
	        
	        
	        game.physics.p2.setPostBroadphaseCallback(checkOverlap, this);  //Checks the overlap!!!!
	        
	        finishtext =  game.add.text(game.world.centerX, 50, "Congratulations, you win!", { font: '24px Arial', fill: '#ffffff' });
	        finishtext.anchor.set(0.5);
	        finishtext.alpha = 0;
        }
        
        
        function checkOverlap(body1, body2) {
            if(((body1.sprite.name === 'sprite1a' && body2.sprite.name === 'finish') || (body1.sprite.name === 'finish' && body2.sprite.name === 'sprite1a')) || ((body1.sprite.name === 'sprite1b' && body2.sprite.name === 'finish') || (body1.sprite.name === 'finish' && body2.sprite.name === 'sprite1b'))){
                winning();
                return false;
            }
            else if(((body1.sprite.name === 'sprite1a' && body2.sprite.name === 'obstacle') || (body1.sprite.name === 'obstacle' && body2.sprite.name === 'sprite1a') || ((body1.sprite.name === 'sprite1b' && body2.sprite.name === 'obstacle') || body1.sprite.name === 'obstacle' && body2.sprite.name === 'sprite1b'))){
                losing();
                return false;
            }
            return true;
        }
        
        function winning(){
            //Here we should add the win menu
            console.log('GAME LEVEL COMPLETED!');
	        game.add.tween(finishtext).to({y: 300}, 200, "Linear", true);
	        game.add.tween(finishtext).to({alpha: 1}, 200, "Linear", true);
        }
                
        function losing(){
            //Here we should add the lose/fail menu
            console.log('COLLISION DETECTED!!');
        }
        
        function moveBlocks() {
            var speed = 200;
            enemyg.setAll('body.velocity.y', speed);
            finish.body.velocity.y = speed;
        }
        
        function update() {
            moveBlocks();
                    
            if (game.input.activePointer.isDown)
            {
                if(game.input.activePointer.x > game.world.centerX)
                {
                    player.body.x += 10;
                    sprite1a.body.x += 10;
                    sprite1b.body.x += 10;
                }
                
                if(game.input.activePointer.x <= game.world.centerX)
                {
                    player.body.x -= 10;
                    sprite1a.body.x -= 10;
                    sprite1b.body.x -= 10;
                }
            }
        }
        
        function render() {

        }
    };    
    </script> 
    </body>
</html>